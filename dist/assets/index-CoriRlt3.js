import{r as g,a as q,R as H}from"./vendor-nf7bT_Uh.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();var B={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z=g,K=Symbol.for("react.element"),Z=Symbol.for("react.fragment"),Q=Object.prototype.hasOwnProperty,X=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ee={key:!0,ref:!0,__self:!0,__source:!0};function M(t,r,i){var o,s={},n=null,a=null;i!==void 0&&(n=""+i),r.key!==void 0&&(n=""+r.key),r.ref!==void 0&&(a=r.ref);for(o in r)Q.call(r,o)&&!ee.hasOwnProperty(o)&&(s[o]=r[o]);if(t&&t.defaultProps)for(o in r=t.defaultProps,r)s[o]===void 0&&(s[o]=r[o]);return{$$typeof:K,type:t,key:n,ref:a,props:s,_owner:X.current}}O.Fragment=Z;O.jsx=M;O.jsxs=M;B.exports=O;var e=B.exports,D={},F=q;D.createRoot=F.createRoot,D.hydrateRoot=F.hydrateRoot;const te=(t,r)=>{const[i,o]=g.useState(()=>{try{const n=window.localStorage.getItem(t);return n?JSON.parse(n):r}catch(n){return console.error("Error reading from localStorage",n),r}});return[i,n=>{try{const a=n instanceof Function?n(i):n;o(a),window.localStorage.setItem(t,JSON.stringify(a))}catch(a){console.error("Error writing to localStorage",a)}}]},v=({onClick:t,children:r,disabled:i=!1,className:o="",variant:s="primary"})=>{const n="flex items-center justify-center gap-2 px-4 py-2 font-semibold rounded-lg shadow-md transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900",a={primary:"text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-500",secondary:"text-gray-200 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-500",danger:"text-white bg-red-600 hover:bg-red-700 disabled:bg-red-400",warning:"bg-yellow-600/20 hover:bg-yellow-600/40 text-yellow-300"};return e.jsx("button",{onClick:t,disabled:i,className:`${n} ${a[s]} ${o}`,children:r})},I=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]}),re=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 12h8"}),e.jsx("path",{d:"M12 8v8"})]}),se=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),ne=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),U=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}),e.jsx("path",{d:"M12 12v9"}),e.jsx("path",{d:"m16 16-4-4-4 4"})]}),G=({className:t,size:r=24})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),ae=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}),e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"})]}),oe=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M3 21v-5h5"})]}),ie=({className:t,size:r=24})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"m12 5 7 7-7 7"})]}),le=({className:t,size:r=24})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.71 0L11.5 9.51l8.84 8.84 7.15-7.15a1.21 1.21 0 0 0 0-1.71l-1.27-1.28zM11.5 9.51 2.66 18.35l-1.28-1.27a1.21 1.21 0 0 1 0-1.71l8.84-8.84-1.71-1.71a1.21 1.21 0 0 0-1.71 0l-1.28 1.28-2.55-2.55a1.21 1.21 0 0 0-1.71 0L1 4.9l8.84 8.84 2.55-2.55.51-.51z"})}),ce=({projects:t,createNewProject:r,deleteProject:i,selectProject:o})=>e.jsx("div",{className:"min-h-screen bg-gray-900 text-gray-200 font-sans p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("header",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold text-white tracking-tight",children:"Animation Studio"}),e.jsx("p",{className:"mt-4 text-lg text-gray-400",children:"Your projects are saved in your browser's local storage."})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(v,{onClick:r,children:[e.jsx(re,{size:20})," New Project"]})}),e.jsx("div",{className:"space-y-4",children:t.length>0?t.sort((s,n)=>new Date(n.createdAt)-new Date(s.createdAt)).map(s=>e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4 flex justify-between items-center transition hover:border-indigo-500",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:`By ${s.author||"Unknown"} | ${s.totalPages||0} Pages | Created: ${new Date(s.createdAt).toLocaleDateString()}`})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>o(s.id),variant:"secondary",children:"Open"}),e.jsx(v,{onClick:()=>i(s),variant:"danger",children:e.jsx(se,{size:16})})]})]},s.id)):e.jsxs("div",{className:"text-center text-gray-500 border-2 border-dashed border-gray-700 rounded-lg p-12",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-300",children:"No projects yet"}),e.jsx("p",{className:"mt-2",children:'Click "New Project" to start creating your animation!'})]})})]})}),de=({project:t,currentSceneId:r,setCurrentSceneId:i,goToDashboard:o})=>{const s=t.totalPages>0?["cover",...Array.from({length:t.totalPages},(a,l)=>String(l+1)),"end"]:[],n=s.findIndex(a=>!t.scenes[a]||t.scenes[a].status!=="completed");return e.jsxs("nav",{className:"w-full md:w-64 bg-gray-900/50 border-b md:border-b-0 md:border-r border-gray-800 p-4 flex flex-col",children:[e.jsxs(v,{onClick:o,variant:"secondary",className:"mb-6",children:[e.jsx(ne,{size:16})," Dashboard"]}),s.length>0&&e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Project Pages"}),e.jsx("ul",{className:"space-y-2",children:s.map((a,l)=>{const c=a===r,d=n!==-1&&l>n;let h="";return a==="cover"?h="Cover":a==="end"?h="End Scene":h=`Page ${a}`,e.jsx("li",{children:e.jsx("button",{onClick:()=>!d&&i(a),disabled:d,className:`w-full text-left px-3 py-2 rounded-md text-sm transition-colors ${c?"bg-indigo-600 text-white":"text-gray-300 hover:bg-gray-700"} ${d?"opacity-50 cursor-not-allowed":""}`,children:h})},a)})})]})},he=({initialTitle:t,initialAuthor:r,onConfirm:i,onCancel:o})=>{const[s,n]=g.useState(t),[a,l]=g.useState(r),c=()=>{i({confirmedTitle:s,confirmedAuthor:a})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Review and Confirm"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Please correct the extracted Title and Author before creating the project."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block mb-2 text-sm font-medium text-gray-300",children:"Book Title"}),e.jsx("input",{type:"text",id:"title",value:s,onChange:d=>n(d.target.value),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"author",className:"block mb-2 text-sm font-medium text-gray-300",children:"Author Name"}),e.jsx("input",{type:"text",id:"author",value:a,onChange:d=>l(d.target.value),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(v,{onClick:o,variant:"secondary",children:"Cancel"}),e.jsx(v,{onClick:c,variant:"primary",children:"Confirm and Create Project"})]})]})})},me={type:"OBJECT",properties:{story_pages:{type:"ARRAY",description:"An array of objects, where each object represents a page containing the main story narrative.",items:{type:"OBJECT",properties:{page_number:{type:"NUMBER",description:"The original page number from the PDF."},text:{type:"STRING",description:"The narrative text from this page."}},required:["page_number","text"]}}},required:["story_pages"]},pe={type:"OBJECT",properties:{page_number:{type:"NUMBER"},scene_summary:{type:"STRING"},animation_style:{type:"OBJECT",properties:{style:{type:"STRING"},color_palette:{type:"STRING"},tone:{type:"STRING"}}},scene:{type:"OBJECT",properties:{location:{type:"STRING"},time_of_day:{type:"STRING"},environment_details:{type:"STRING"}}},characters:{type:"ARRAY",items:{type:"OBJECT",properties:{character_id:{type:"STRING",description:"A unique, simple, lowercase ID for the character (e.g., 'mikey', 'grandfather')."},description:{type:"STRING",description:"A detailed visual description of the character's appearance and clothing."},initial_expression:{type:"STRING",description:"The character's primary emotion or expression at the start of the scene."},is_present_in_scene:{type:"BOOLEAN",description:"Set to true if the character is visually present in the illustration for this specific page, otherwise set to false."}},required:["character_id","description","initial_expression","is_present_in_scene"]}},camera:{type:"OBJECT",properties:{shot_type:{type:"STRING"},movement:{type:"STRING"}}},action:{type:"OBJECT",properties:{primary_action:{type:"STRING"},subtle_motions:{type:"STRING"}}},metadata:{type:"OBJECT",properties:{estimated_duration_seconds:{type:"NUMBER"},notes:{type:"STRING"}}},extracted_title:{type:"STRING"},extracted_author:{type:"STRING"}}},ge=async(t,r)=>{const o={contents:[{role:"user",parts:[{text:`
    You are a literary assistant. Analyze the following pages from a children's book...
    Here is the text from the pages:
    ${t.map(s=>`Page ${s.pageNum}: "${s.text}"`).join(`
`)}
  `}]}],generationConfig:{responseMimeType:"application/json",responseSchema:me}};try{const s=await fetch("/api/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!s.ok){const a=await s.text();throw new Error(`API Error: ${s.status} ${s.statusText} - ${a}`)}const n=await s.json();if(n.candidates&&n.candidates.length>0){const a=n.candidates[0].content.parts[0].text;return JSON.parse(a).story_pages}else throw console.error("API Response for story content was empty or invalid:",n),new Error("The model returned an empty or invalid response for story content.")}catch(s){throw console.error("Error in findStoryContent:",s),r(s.message),s}},xe=(t,r,i)=>{var d;const o=`You are a precise and detail-oriented animation director. Your primary goal is to create a structured JSON animation prompt from a children's book page.
  
**CRITICAL RULES:**
1.  **Character Presence is Gospel:** The illustration is the ONLY source of truth for determining WHICH CHARACTERS ARE VISUALLY PRESENT. For every known character in the story's glossary, you MUST include them in the 'characters' array and set 'is_present_in_scene' to 'true' or 'false' based ONLY on who you can see in the current illustration. Do not add characters who are not visible.
2.  **Character Identity & Decomposition:** Decompose group descriptions (e.g., "a family") into individual character objects. If a new name appears in the text (e.g., "Poppy"), first determine if it is a nickname for an existing character from the glossary before creating a new one. Assign simple, consistent, lowercase character_ids (e.g., 'mike', 'dad', 'grandfather').
3.  **Metadata, Not On-Screen Text:** The 'character_id' field is a metadata tag for tracking. It MUST NOT be rendered as visible text in the final video.
4.  **Dynamic and Cinematic Animation:** Describe camera movements and character actions with dynamic, evocative, and cinematic language to create an engaging result.`;let s="";const n=((d=t.scenes[r])==null?void 0:d.text)||"";let a=`### Established Story Context
`;const l={};let c=null;if(Object.values(t.scenes).forEach(h=>{h.status==="completed"&&h.prompt&&h.prompt.characters&&(h.prompt.characters.forEach(x=>{x.character_id&&!l[x.character_id]&&(l[x.character_id]=x.description)}),!c&&h.prompt.animation_style&&(c=h.prompt.animation_style))}),Object.keys(l).length>0){a+=`
**Character Glossary:**
`;for(const[h,x]of Object.entries(l))a+=`- ${h}: ${x}
`}else a+=`
No characters have been established yet.
`;return c&&(a+=`
**Animation Style Guide:**
- Style: ${c.style}
- Tone: ${c.tone}
- Palette: ${c.color_palette}
`),r==="cover"?s=`This is the COVER SCENE. Your task is to generate a structured and visually dynamic title sequence.
    1.  **Extract Main Info:** Identify the main book Title and the Author's name. Populate the top-level 'extracted_title' and 'extracted_author' fields. IGNORE all other text like 'Illustrated by' or small taglines.
    2.  **Describe the Overall Scene:** Crucially, analyze the visual elements of the cover illustration (characters, setting, mood). Describe a dynamic, animated version of this scene in the main 'action', 'scene', and 'animation_style' fields. Make it engaging and hint at the story's themes. Do not leave 'subtle_motions' as 'None'. For example, describe an animated background based on the cover art.
    3.  **Build Animation Timeline:** Create a 'title_sequence' array with separate, sequential steps for the title and author. Use an ORDERLY animation style like 'reveal word by word' or 'gentle fade-in' and AVOID chaotic, scattered effects. The author's animation MUST start after the title's animation ends. For multi-line titles, create a separate step for each line.
    4.  **Add Director's Note:** In the 'metadata.notes' field, add a note to ensure the final text layout is clean and visually appealing, without duplicated or overlapping words.`:r==="end"?s="This is the final scene. Generate a concluding animation prompt. Use the Character Glossary to create a gentle, summary scene evoking a feeling of happy resolution.":s=`Analyze the attached illustration and its corresponding text for Page ${r}. Generate a detailed animation prompt. Strictly follow all rules in the System Instruction, especially the 'Roll Call' for character presence based on the illustration.`,i&&(s+=`

REGENERATION FEEDBACK: The previous attempt was not quite right. Please regenerate the JSON, taking this user feedback into account: "${i}"`),`
    ${o}
    ---
    ${a}
    ---
    FULL STORY NARRATIVE:
    ${t.storyText}
    ---
    CURRENT SCENE ANALYSIS TASK:
    - Scene ID: ${r}
    - Scene Text: "${n}"
    - Task: ${s}
    Now, populate the JSON schema based on all the rules and context provided.
  `},J=async(t,r,i,o,s)=>{const a={contents:[{role:"user",parts:[{text:xe(t,r,o)},...i?[{inlineData:{mimeType:"image/jpeg",data:i}}]:[]]}],generationConfig:{responseMimeType:"application/json",responseSchema:pe}};try{const l=await fetch("/api/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){const d=await l.text();throw new Error(`API Error: ${l.status} ${l.statusText} - ${d}`)}const c=await l.json();if(c.candidates&&c.candidates.length>0&&c.candidates[0].content.parts[0].text){const d=c.candidates[0].content.parts[0].text;return JSON.parse(d)}else throw console.error("API Response was empty or invalid:",c),new Error("The model returned an empty or invalid response.")}catch(l){throw console.error("Error in generateScene:",l),s(l.message),l}},ue=({project:t,updateProject:r,setCurrentSceneId:i,setError:o})=>{const[s,n]=g.useState(!1),[a,l]=g.useState(""),[c,d]=g.useState(null),[h,x]=g.useState(null),k=async m=>{const p=m.target.files[0];if(p){d(p),n(!0),o("");try{l("Extracting text from PDF...");let u="";const f=[];if(p.type==="application/pdf"){if(!window.pdfjsLib)throw new Error("PDF parsing library not loaded.");const P=await p.arrayBuffer(),_=await window.pdfjsLib.getDocument(P).promise;for(let L=1;L<=_.numPages;L++){const Y=await(await _.getPage(L)).getTextContent();f.push({pageNum:L,text:Y.items.map(V=>V.str).join(" ")})}l("Extracting cover image...");const C=await _.getPage(1),N=C.getViewport({scale:1}),A=document.createElement("canvas");A.height=N.height,A.width=N.width,await C.render({canvasContext:A.getContext("2d"),viewport:N}).promise,u=A.toDataURL("image/jpeg",.7).split(",")[1]}else throw new Error("Unsupported file type. Please upload a PDF file.");l("Analyzing story content...");const y=await ge(f,o);if(!y||y.length===0)throw new Error("AI could not identify the main story pages in the document.");const b=y.length,w=y.map(P=>P.text).join(`

`),R={cover:{status:"pending"},end:{status:"pending"}};y.forEach((P,_)=>{R[String(_+1)]={status:"pending",text:P.text}});const S={...t,storyText:w,totalPages:b,scenes:R};l("Generating opening scene...");const T=await J(S,"cover",u,"",o),E=T.extracted_title||p.name.replace(/\.pdf$/i,"")||"Untitled Project",$=T.extracted_author||"Unknown Author";x({initialProjectState:S,newPrompt:T,aiGuessedTitle:E,aiGuessedAuthor:$})}catch(u){o(u.message),n(!1)}}},j=({confirmedTitle:m,confirmedAuthor:p})=>{const{initialProjectState:u,newPrompt:f}=h;f.extracted_title=m,f.extracted_author=p;const y={...u.scenes,cover:{status:"completed",prompt:f}},b={...u,scenes:y,name:m,author:p};r(t.id,b),i("cover"),x(null),n(!1)};return e.jsxs(e.Fragment,{children:[h&&e.jsx(he,{initialTitle:h.aiGuessedTitle,initialAuthor:h.aiGuessedAuthor,onConfirm:j,onCancel:()=>{x(null),n(!1)}}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Upload Your Book's Layout"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Upload your book's layout as a PDF. The app will extract the text, use the first page as the cover, and automatically generate the opening scene."}),e.jsxs("label",{htmlFor:"story-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-600 border-dashed rounded-lg bg-gray-800/50 transition cursor-pointer hover:bg-gray-700/50",children:[s?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"animate-spin text-indigo-400",size:32}),e.jsx("p",{className:"mt-2 text-indigo-300",children:a})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{size:32}),e.jsx("p",{className:"mt-2",children:c?c.name:"Click to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF file only"})]}),e.jsx("input",{id:"story-upload",type:"file",className:"hidden",accept:".pdf,application/pdf",onChange:k,disabled:s})]})]})]})},W=({sceneId:t,project:r,updateProject:i,setError:o,isRegenerating:s=!1})=>{var b;const[n,a]=g.useState(null),[l,c]=g.useState(""),[d,h]=g.useState(""),[x,k]=g.useState(!1),[j,m]=g.useState("Generating..."),p=w=>{const R=w.target.files[0];if(R){a(R);const S=new FileReader;S.onloadend=()=>{const T=new Image;T.onload=()=>{const E=document.createElement("canvas"),$=E.getContext("2d"),P=1024,_=1024;let C=T.width,N=T.height;C>N?C>P&&(N*=P/C,C=P):N>_&&(C*=_/N,N=_),E.width=C,E.height=N,$.drawImage(T,0,0,C,N),c(E.toDataURL("image/jpeg",.8).split(",")[1])},T.src=S.result},S.readAsDataURL(R)}},u=async()=>{if(t!=="end"&&!l&&!s){o("Please upload an illustration for this page.");return}k(!0),m("Generating JSON prompt..."),o("");try{const w=await J(r,t,l,d,o);let S={scenes:{...r.scenes,[t]:{...r.scenes[t],status:"completed",prompt:w}}};t==="cover"&&w.extracted_title&&(S.name=w.extracted_title,S.author=w.extracted_author||"Unknown Author"),i(r.id,S)}catch(w){o(`Operation failed: ${w.message}.`)}finally{k(!1)}},f=(b=r.scenes[t])==null?void 0:b.text;let y="";return t==="cover"?y="Generate Cover Animation":t==="end"?y="Generate End Scene":y=`Generate Animation for Page ${t}`,s&&(y=`Regenerate: ${y.split(" ")[1]} Scene`),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:y}),t!=="end"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-300",children:`Illustration for Page ${t}`}),e.jsxs("label",{htmlFor:"scene-image-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer hover:bg-gray-700/50",children:[l?e.jsx("img",{src:`data:image/jpeg;base64,${l}`,alt:"Preview",className:"max-h-full max-w-full object-contain rounded-md"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{})," ",e.jsx("p",{children:n?n.name:"Click to upload"})]}),e.jsx("input",{id:"scene-image-upload",type:"file",className:"hidden",accept:"image/*",onChange:p})]})]}),f&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-300",children:"Scene Text"}),e.jsx("p",{className:"text-gray-400 bg-gray-900 p-4 rounded-md",children:f})]}),s&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"feedback-text",className:"block mb-2 font-semibold text-gray-300",children:"What would you like to change?"}),e.jsx("textarea",{id:"feedback-text",value:d,onChange:w=>h(w.target.value),placeholder:"e.g., Make the character's smile bigger. Change the camera to a slow zoom in.",className:"w-full h-24 p-3 bg-gray-900 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition"})]}),t==="end"&&e.jsx("p",{className:"text-gray-300 mb-4",children:"All pages are complete. The end scene will be generated using the context of the entire story."}),e.jsx(v,{onClick:u,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"animate-spin"})," ",j]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{})," Generate Scene"]})})]})},fe=({sceneId:t,project:r,updateProject:i,setCurrentSceneId:o,setError:s})=>{const n=r.scenes[t],[a,l]=g.useState(!1),[c,d]=g.useState(""),h=()=>{if(!(n!=null&&n.prompt))return;const j=JSON.stringify(n.prompt,null,2),m=document.createElement("textarea");m.value=j,m.style.position="fixed",m.style.opacity="0",document.body.appendChild(m),m.focus(),m.select();try{document.execCommand("copy"),d("Copied!")}catch(p){d("Failed!"),console.error("Fallback: Oops, unable to copy",p)}document.body.removeChild(m),setTimeout(()=>d(""),2e3)},k=(()=>{const j=["cover",...Array.from({length:r.totalPages},(p,u)=>String(u+1)),"end"],m=j.findIndex(p=>p===t);return j[m+1]})();return e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:`Completed: ${t==="cover"?"Cover":t==="end"?"End Scene":`Page ${t}`}`}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center mb-4 pb-4 border-b border-gray-700",children:[e.jsxs(v,{onClick:h,variant:"primary",children:[e.jsx(ae,{size:16})," ",c||"Copy Prompt"]}),e.jsxs(v,{onClick:()=>l(j=>!j),variant:"warning",children:[e.jsx(oe,{size:16})," ",a?"Cancel":"Regenerate"]}),k&&e.jsxs(v,{onClick:()=>o(k),variant:"secondary",children:["Go to Next Scene ",e.jsx(ie,{size:16})]})]}),e.jsxs("div",{className:"bg-gray-900 mt-4 p-4 rounded-md font-mono text-sm overflow-x-auto",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-200 mb-2",children:"Animation Prompt"}),e.jsx("pre",{children:e.jsx("code",{children:JSON.stringify(n.prompt,null,2)})})]}),a&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-700",children:e.jsx(W,{sceneId:t,project:r,updateProject:i,setError:s,isRegenerating:!0})})]})},ye=({project:t,updateProject:r,currentSceneId:i,setCurrentSceneId:o,setError:s})=>{const n=t.scenes[i];return t.storyText?n&&n.status==="completed"?e.jsx(fe,{sceneId:i,project:t,updateProject:r,setCurrentSceneId:o,setError:s}):e.jsx(W,{sceneId:i,project:t,updateProject:r,setError:s}):e.jsx(ue,{project:t,updateProject:r,setCurrentSceneId:o,setError:s})},je=({project:t,updateProject:r,goToDashboard:i,libraryError:o})=>{const[s,n]=g.useState("cover"),[a,l]=g.useState("");return g.useEffect(()=>{if(t.storyText){const d=["cover",...Array.from({length:t.totalPages},(h,x)=>String(x+1)),"end"].find(h=>!t.scenes[h]||t.scenes[h].status!=="completed");n(d||"end")}else n("cover")},[t.id]),e.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-200 font-sans flex flex-col md:flex-row",children:[e.jsx(de,{project:t,currentSceneId:s,setCurrentSceneId:n,goToDashboard:i}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto",style:{maxHeight:"100vh"},children:[e.jsx("header",{className:"mb-8 flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:t.name}),e.jsx("p",{className:"text-md text-gray-400",children:`By: ${t.author}`})]})}),a&&e.jsxs("div",{className:"w-full bg-red-500/20 border border-red-500 text-red-300 p-4 rounded-lg mb-4 flex gap-2",children:[e.jsx(I,{className:"flex-shrink-0"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Error: "}),a]})]}),o&&e.jsxs("div",{className:"w-full bg-red-500/20 border border-red-500 text-red-300 p-4 rounded-lg mb-4 flex gap-2",children:[e.jsx(I,{className:"flex-shrink-0"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Library Error: "}),o]})]}),e.jsx(ye,{project:t,updateProject:r,currentSceneId:s,setCurrentSceneId:n,setError:l})]})]})},be=({project:t,onConfirm:r,onCancel:i})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20",children:e.jsx(I,{className:"h-6 w-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Delete Project"}),e.jsx("p",{className:"text-sm text-gray-400",children:`Are you sure you want to delete "${t.name}"? This action cannot be undone.`})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(v,{onClick:i,variant:"secondary",children:"Cancel"}),e.jsx(v,{onClick:r,variant:"danger",children:"Delete"})]})]})}):null;function we(){const[t,r]=te("animation-projects",[]),[i,o]=g.useState(null),[s,n]=g.useState(!1),[a,l]=g.useState(""),[c,d]=g.useState(null);g.useEffect(()=>{(p=>new Promise((u,f)=>{if(document.querySelector(`script[src="${p}"]`)){u();return}const b=document.createElement("script");b.src=p,b.async=!0,b.onload=u,b.onerror=()=>f(new Error(`Failed to load script: ${p}`)),document.body.appendChild(b)}))("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js").then(()=>{window.pdfjsLib&&(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"),n(!0)}).catch(p=>{console.error(p),l("Failed to load necessary libraries. Please refresh the page.")})},[]);const h=()=>{const m={id:`proj_${Date.now()}`,name:"Untitled Project",author:"Unknown Author",storyText:"",totalPages:0,scenes:{},createdAt:new Date().toISOString()};r(p=>[...p,m]),o(m.id)},x=()=>{c&&(r(m=>m.filter(p=>p.id!==c.id)),d(null),i===c.id&&o(null))},k=g.useCallback((m,p)=>{r(u=>u.map(f=>f.id===m?{...f,...p}:f))},[r]),j=t.find(m=>m.id===i);return s?a?e.jsxs("div",{className:"min-h-screen bg-gray-900 text-red-400 flex items-center justify-center p-4 text-center",children:[e.jsx(I,{className:"mr-2"}),a]}):i&&j?e.jsx(je,{project:j,updateProject:k,goToDashboard:()=>o(null),libraryError:a}):e.jsxs(e.Fragment,{children:[e.jsx(be,{project:c,onConfirm:x,onCancel:()=>d(null)}),e.jsx(ce,{projects:t,createNewProject:h,deleteProject:m=>d(m),selectProject:o})]}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-200 flex items-center justify-center",children:[e.jsx(G,{className:"animate-spin mr-2"}),"Loading Libraries..."]})}D.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(we,{})}));
